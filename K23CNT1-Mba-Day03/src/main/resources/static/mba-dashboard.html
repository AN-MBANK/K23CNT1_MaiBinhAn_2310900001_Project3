<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Mba Thống Kê</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">
    <style>
        body {
    background-image: linear-gradient(to right top, #051937, #004d7a, #008793, #00bf72, #a8eb12); /* Thay bằng màu bạn muốn */
    color: #333;
    font-family: Arial, sans-serif;
    padding: 20px;
}

table {
    background-color: #ffffff; /* nền table */
    border-collapse: collapse;
    margin-top: 20px;
}

th {
    background-color: #d9b3ff; /* header table màu nhẹ */
}

td {
    background-color: #f9f0ff; /* hàng table màu nhạt */
}

/* Nút */
button {
    border-radius: 4px;
}

/* Navbar link */
.navbar a {
    color: #6a1b9a;
}

.navbar a.active {
    background-color: #a67eff;
    color: #fff;
}

    </style>
</head>
<body>
<div class="container mt-5">
    <h1 class="mb-4">MBA Thống Kê</h1>

    <!-- Tabs -->
    <ul class="nav nav-tabs" id="mbaTab" role="tablist">
        <li class="nav-item"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#khoa">Khoa</button></li>
        <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#monhoc">Môn Học</button></li>
        <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#employee">Employee</button></li>
        <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#student">Student</button></li>
    </ul>

    <div class="tab-content mt-3">

        <!-- Khoa -->
        <div class="tab-pane fade show active" id="khoa">
            <div class="d-flex justify-content-between mb-2">
                <h4>Khoa</h4>
                <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#khoaModal" onclick="openKhoaModal()">Thêm Khoa</button>
            </div>
            <table id="khoaTable" class="table table-striped table-bordered">
                <thead>
                <tr>
                    <th>ID</th>
                    <th>Tên Khoa</th>
                    <th>Hành Động</th>
                </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>

        <!-- MonHoc -->
        <div class="tab-pane fade" id="monhoc">
            <div class="d-flex justify-content-between mb-2">
                <h4>Môn Học</h4>
                <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#monHocModal" onclick="openMonHocModal()">Thêm Môn Học</button>
            </div>
            <table id="monhocTable" class="table table-striped table-bordered">
                <thead>
                <tr>
                    <th>ID</th>
                    <th>Tên Môn Học</th>
                    <th>Số Tiết</th>
                    <th>Hành Động</th>
                </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>

        <!-- Employee -->
        <div class="tab-pane fade" id="employee">
            <div class="d-flex justify-content-between mb-2">
                <h4>Employee</h4>
                <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#employeeModal" onclick="openEmployeeModal()">Thêm Employee</button>
            </div>
            <table id="employeeTable" class="table table-striped table-bordered">
                <thead>
                <tr>
                    <th>ID</th>
                    <th>Họ Tên</th>
                    <th>Giới Tính</th>
                    <th>Tuổi</th>
                    <th>Lương</th>
                    <th>Hành Động</th>
                </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>

        <!-- Student -->
        <div class="tab-pane fade" id="student">
            <div class="d-flex justify-content-between mb-2">
                <h4>Student</h4>
                <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#studentModal" onclick="openStudentModal()">Thêm Student</button>
            </div>
            <table id="studentTable" class="table table-striped table-bordered">
                <thead>
                <tr>
                    <th>ID</th>
                    <th>Họ Tên</th>
                    <th>Giới Tính</th>
                    <th>Tuổi</th>
                    <th>Địa Chỉ</th>
                    <th>Điện Thoại</th>
                    <th>Email</th>
                    <th>Hành Động</th>
                </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>

    </div>
</div>

<!-- ==================== MODALS ==================== -->

<!-- Khoa Modal -->
<div class="modal fade" id="khoaModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="khoaModalTitle">Thêm Khoa</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="khoaForm">
                    <input type="hidden" id="khoaId">
                    <div class="mb-2">
                        <label>Tên Khoa</label>
                        <input type="text" class="form-control" id="khoaName" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                <button type="button" class="btn btn-primary" onclick="saveKhoa()">Lưu</button>
            </div>
        </div>
    </div>
</div>

<!-- MonHoc Modal -->
<div class="modal fade" id="monHocModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="monHocModalTitle">Thêm Môn Học</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="monHocForm">
                    <input type="hidden" id="monHocId">
                    <div class="mb-2">
                        <label>Tên Môn Học</label>
                        <input type="text" class="form-control" id="monHocName" required>
                    </div>
                    <div class="mb-2">
                        <label>Số Tiết</label>
                        <input type="number" class="form-control" id="monHocSoTiet" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                <button type="button" class="btn btn-primary" onclick="saveMonHoc()">Lưu</button>
            </div>
        </div>
    </div>
</div>

<!-- Employee Modal -->
<div class="modal fade" id="employeeModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="employeeModalTitle">Thêm Employee</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="employeeForm">
                    <input type="hidden" id="employeeId">
                    <div class="mb-2"><label>Họ Tên</label><input type="text" class="form-control" id="employeeName"></div>
                    <div class="mb-2"><label>Giới Tính</label>
                        <select class="form-control" id="employeeGender">
                            <option value="Nam">Nam</option>
                            <option value="Nữ">Nữ</option>
                        </select>
                    </div>
                    <div class="mb-2"><label>Tuổi</label><input type="number" class="form-control" id="employeeAge"></div>
                    <div class="mb-2"><label>Lương</label><input type="number" class="form-control" id="employeeSalary"></div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                <button class="btn btn-primary" onclick="saveEmployee()">Lưu</button>
            </div>
        </div>
    </div>
</div>

<!-- Student Modal -->
<div class="modal fade" id="studentModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="studentModalTitle">Thêm Student</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="studentForm">
                    <input type="hidden" id="studentId">
                    <div class="mb-2"><label>Họ Tên</label><input type="text" class="form-control" id="studentName"></div>
                    <div class="mb-2"><label>Giới Tính</label>
                        <select class="form-control" id="studentGender">
                            <option value="Nam">Nam</option>
                            <option value="Nữ">Nữ</option>
                        </select>
                    </div>
                    <div class="mb-2"><label>Tuổi</label><input type="number" class="form-control" id="studentAge"></div>
                    <div class="mb-2"><label>Địa Chỉ</label><input type="text" class="form-control" id="studentAddress"></div>
                    <div class="mb-2"><label>Điện Thoại</label><input type="text" class="form-control" id="studentPhone"></div>
                    <div class="mb-2"><label>Email</label><input type="email" class="form-control" id="studentEmail"></div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                <button class="btn btn-primary" onclick="saveStudent()">Lưu</button>
            </div>
        </div>
    </div>
</div>

<!-- ==================== SCRIPTS ==================== -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>

<script>
    let editingKhoa=null, editingMonHoc=null, editingEmployee=null, editingStudent=null;

    // ==================== Hàm render table ====================
    function loadTable(apiUrl, tableId, columns, actionsCallback) {
        $.getJSON(apiUrl, function(data){
            const tbody = $(tableId+' tbody'); tbody.empty();
            data.forEach(item=>{
                let row='<tr>';
                columns.forEach(col=>{ row+=`<td>${item[col]}</td>`; });
                if(actionsCallback) row+=`<td>${actionsCallback(item)}</td>`;
                row+='</tr>'; tbody.append(row);
            });
            $(tableId).DataTable();
        });
    }

    function reloadTables() {
        $('#khoaTable').DataTable().destroy();
        $('#monhocTable').DataTable().destroy();
        $('#employeeTable').DataTable().destroy();
        $('#studentTable').DataTable().destroy();
        loadTables();
    }

    function loadTables(){
        // Khoa
        loadTable('/api/mba-khoas','#khoaTable', ['mbaMakh','mbaTenkh'],
            item=>`<button class="btn btn-primary btn-sm action-btn" onclick='openKhoaModal(${JSON.stringify(item)})'>Sửa</button>
                   <button class="btn btn-danger btn-sm action-btn" onclick='deleteKhoa("${item.mbaMakh}")'>Xóa</button>`);

        // MonHoc
        loadTable('/api/mba-monhocs','#monhocTable', ['mbaMamh','mbaTenmh','mbaSotiet'],
            item=>`<button class="btn btn-primary btn-sm action-btn" onclick='openMonHocModal(${JSON.stringify(item)})'>Sửa</button>
                   <button class="btn btn-danger btn-sm action-btn" onclick='deleteMonHoc("${item.mbaMamh}")'>Xóa</button>`);

        // Employee
        loadTable('/api/mba-employees','#employeeTable', ['mbaId','mbaFullName','mbaGender','mbaAge','mbaSalary'],
            item=>`<button class="btn btn-primary btn-sm action-btn" onclick='openEmployeeModal(${JSON.stringify(item)})'>Sửa</button>
                   <button class="btn btn-danger btn-sm action-btn" onclick='deleteEmployee(${item.mbaId})'>Xóa</button>`);

        // Student
        loadTable('/mba-students','#studentTable', ['mbaId','mbaName','mbaGender','mbaAge','mbaAddress','mbaPhone','mbaEmail'],
            item=>`<button class="btn btn-primary btn-sm action-btn" onclick='openStudentModal(${JSON.stringify(item)})'>Sửa</button>
                   <button class="btn btn-danger btn-sm action-btn" onclick='deleteStudent(${item.mbaId})'>Xóa</button>`);
    }

    $(document).ready(loadTables);

    // ==================== CRUD Khoa ====================
    function openKhoaModal(item=null){
        editingKhoa=item;
        $('#khoaModalTitle').text(item?'Sửa Khoa':'Thêm Khoa');
        $('#khoaId').val(item?.mbaMakh||'');
        $('#khoaName').val(item?.mbaTenkh||'');
        $('#khoaModal').modal('show');
    }

    function saveKhoa(){
        const data={mbaTenkh:$('#khoaName').val()};
        if(editingKhoa){
            $.ajax({url:`/api/mba-khoas/${editingKhoa.mbaMakh}`, type:'PUT', contentType:'application/json', data:JSON.stringify(data), success:()=>{$('#khoaModal').modal('hide'); reloadTables();}});
        }else{
            $.ajax({url:'/api/mba-khoas', type:'POST', contentType:'application/json', data:JSON.stringify(data), success:()=>{ $('#khoaModal').modal('hide'); reloadTables();}});
        }
    }

    function deleteKhoa(id){ if(confirm('Xóa Khoa?')) $.ajax({url:`/api/mba-khoas/${id}`, type:'DELETE', success:()=>reloadTables()}); }

    // ==================== CRUD MonHoc ====================
    function openMonHocModal(item=null){
        editingMonHoc=item;
        $('#monHocModalTitle').text(item?'Sửa Môn Học':'Thêm Môn Học');
        $('#monHocId').val(item?.mbaMamh||'');
        $('#monHocName').val(item?.mbaTenmh||'');
        $('#monHocSoTiet').val(item?.mbaSotiet||'');
        $('#monHocModal').modal('show');
    }

    function saveMonHoc(){
        const data={mbaTenmh:$('#monHocName').val(), mbaSotiet:parseInt($('#monHocSoTiet').val())};
        if(editingMonHoc){
            $.ajax({url:`/api/mba-monhocs/${editingMonHoc.mbaMamh}`, type:'PUT', contentType:'application/json', data:JSON.stringify(data), success:()=>{ $('#monHocModal').modal('hide'); reloadTables();}});
        }else{
            $.ajax({url:'/api/mba-monhocs', type:'POST', contentType:'application/json', data:JSON.stringify(data), success:()=>{ $('#monHocModal').modal('hide'); reloadTables();}});
        }
    }

    function deleteMonHoc(id){ if(confirm('Xóa Môn Học?')) $.ajax({url:`/api/mba-monhocs/${id}`, type:'DELETE', success:()=>reloadTables()}); }

    // ==================== CRUD Employee ====================
    function openEmployeeModal(item=null){
        editingEmployee=item;
        $('#employeeModalTitle').text(item?'Sửa Employee':'Thêm Employee');
        $('#employeeId').val(item?.mbaId||'');
        $('#employeeName').val(item?.mbaFullName||'');
        $('#employeeGender').val(item?.mbaGender||'Nam');
        $('#employeeAge').val(item?.mbaAge||'');
        $('#employeeSalary').val(item?.mbaSalary||'');
        $('#employeeModal').modal('show');
    }

    function saveEmployee(){
        const data={mbaFullName:$('#employeeName').val(), mbaGender:$('#employeeGender').val(), mbaAge:parseInt($('#employeeAge').val()), mbaSalary:parseFloat($('#employeeSalary').val())};
        if(editingEmployee){
            $.ajax({url:`/api/mba-employees/${editingEmployee.mbaId}`, type:'PUT', contentType:'application/json', data:JSON.stringify(data), success:()=>{$('#employeeModal').modal('hide'); reloadTables();}});
        }else{
            $.ajax({url:'/api/mba-employees', type:'POST', contentType:'application/json', data:JSON.stringify(data), success:()=>{$('#employeeModal').modal('hide'); reloadTables();}});
        }
    }

    function deleteEmployee(id){ if(confirm('Xóa Employee?')) $.ajax({url:`/api/mba-employees/${id}`, type:'DELETE', success:()=>reloadTables()}); }

    // ==================== CRUD Student ====================
function openStudentModal(item=null){
    editingStudent = item;
    $('#studentModalTitle').text(item ? 'Sửa Student' : 'Thêm Student');
    $('#studentId').val(item?.mbaId || '');
    $('#studentName').val(item?.mbaName || '');
    $('#studentGender').val(item?.mbaGender || 'Nam');
    $('#studentAge').val(item?.mbaAge || '');
    $('#studentAddress').val(item?.mbaAddress || '');
    $('#studentPhone').val(item?.mbaPhone || '');
    $('#studentEmail').val(item?.mbaEmail || '');
    $('#studentModal').modal('show');
}

function saveStudent(){
    const data = {
        mbaName: $('#studentName').val(),
        mbaGender: $('#studentGender').val(),
        mbaAge: parseInt($('#studentAge').val()),
        mbaAddress: $('#studentAddress').val(),
        mbaPhone: $('#studentPhone').val(),
        mbaEmail: $('#studentEmail').val()
    };
    if(editingStudent){
        // Update
        $.ajax({
            url: `/mba-students/${editingStudent.mbaId}`,
            type: 'PUT',
            contentType: 'application/json',
            data: JSON.stringify(data),
            success: function(){
                $('#studentModal').modal('hide');
                reloadTables();
            }
        });
    } else {
        // Add
        $.ajax({
            url: '/mba-students',
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify(data),
            success: function(){
                $('#studentModal').modal('hide');
                reloadTables();
            }
        });
    }
}

function deleteStudent(id){
    if(confirm('Xóa Student?')){
        $.ajax({
            url: `/mba-students/${id}`,
            type: 'DELETE',
            success: function(){
                reloadTables();
            }
        });
    }
}

</script>